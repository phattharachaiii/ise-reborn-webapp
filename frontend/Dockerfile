FROM node:20-slim
WORKDIR /app

ARG PUBLIC_BACKEND_ORIGIN
ARG PUBLIC_CLOUDINARY_CLOUD_NAME
ARG PUBLIC_CLOUDINARY_UPLOAD_PRESET
ENV PUBLIC_BACKEND_ORIGIN=$PUBLIC_BACKEND_ORIGIN
ENV PUBLIC_CLOUDINARY_CLOUD_NAME=$PUBLIC_CLOUDINARY_CLOUD_NAME
ENV PUBLIC_CLOUDINARY_UPLOAD_PRESET=$PUBLIC_CLOUDINARY_UPLOAD_PRESET

COPY package*.json ./
RUN npm ci

COPY . .
RUN npm run build

EXPOSE 5173
ENV PORT=5173
ENV HOST=0.0.0.0
CMD npm run start   # <- จะเรียก vite preview
